<div id="wrapper">
    <div id="container" style="height: 767px;">
        <% Article.where("id >= 3").sample(8).each do |article| %>
          <div class="grid" >
            <div class="imgholder">
                <a href="/articles/<%= article.id %>" target="_blank">
                   <img class="lazy" src="<%= article.cover_img_path %>"  width="175" style="display: block;">
                </a>
            </div>
            <strong><%= article.title %></strong>
            <p><%= article.min_show %></p>
          </div>
        <% end %>
        <div class="grid" >
            <div class="imgholder"><a href="/articles/3" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/4/906762504.jpg"  width="175" style="display: block;"></a></div>
            <strong>作品1</strong>
            <p>李佳琪小朋友，3岁半，作品：泡泡鱼</p>
        </div>
        <div class="grid" >
            <div class="imgholder"><a href="/articles/4" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/5/544558501.jpg"  width="175" style="display: block;"></a></div>
            <strong>作品2</strong>
            <p>李佳琪小朋友，3岁半，作品：丝瓜爬呀爬</p>
        </div>

        <div class="grid" >
            <div class="imgholder"><a href="/articles/5" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/6/1938973272.jpg"  width="175" style="display: block;"></a></div>
            <strong>作品3</strong>
            <p>李佳琪小朋友，3岁半，作品：小小毛栗子</p>
        </div>
        <div class="grid" >
            <div class="imgholder"><a href="/articles/6" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/7/2072383462.jpg"  width="175" style="display: block;"></a></div>
            <strong>作品4</strong>
            <p>李佳琪小朋友，3岁半，作品：可爱的熊猫</p>
        </div>
        <div class="grid" >
            <div class="imgholder"><a href="/articles/7" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/8/2007620214.jpg"  width="175" style="display: block;"></a></div>
            <strong>作品5</strong>
            <p>李佳琪小朋友，3岁半，作品：霸王龙</p>
        </div>
        <div class="grid" >
            <div class="imgholder"><a href="/articles/8" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/11/1274448566.jpg"  width="175" style="display: block;"></a></div>
            <strong>作品6</strong>
            <p>李佳琪小朋友，3岁半，作品：葡萄</p>
        </div>
        <div class="grid" >
            <div class="imgholder"><a href="/articles/9" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/12/378057947.jpg"  width="175" style="display: block;"></a></div>
            <strong>作品7</strong>
            <p>李佳琪小朋友，3岁半，作品：火山爆发</p>
        </div>
        <div class="grid" >
            <div class="imgholder"><a href="/articles/10" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/13/848359992.jpg"  width="175" style="display: block;"></a></div>
            <strong>作品8</strong>
            <p>李佳琪小朋友，3岁半，作品：三个和尚</p>
        </div>
    </div>

</div>


<div id="test" style="display:none;width: auto;">
    <div class="grid">
        <div class="imgholder"><a href="/articles/3" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/4/906762504.jpg" width="175"></a></div>
        <strong>作品1</strong>
        <p>李佳琪小朋友，3岁半，作品：泡泡鱼</p>
    </div>
    <div class="grid">
        <div class="imgholder"><a href="/articles/4" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/5/544558501.jpg" width="175"></a></div>
        <strong>作品2</strong>
        <p>李佳琪小朋友，3岁半，作品：丝瓜爬呀爬</p>
    </div>
    <div class="grid">
        <div class="imgholder"><a href="/articles/5" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/6/1938973272.jpg" width="175"></a></div>
        <strong>作品3</strong>
        <p>李佳琪小朋友，3岁半，作品：小小毛栗子</p>
    </div>
    <div class="grid">
        <div class="imgholder"><a href="/articles/6" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/7/2072383462.jpg" width="175"></a></div>
        <strong>作品4</strong>
        <p>李佳琪小朋友，3岁半，作品：可爱的熊猫</p>
    </div>
    <div class="grid">
        <div class="imgholder"><a href="/articles/7" target="_blank"><img class="lazy" src="http://47.105.90.31/uploads/picture/path/8/2007620214.jpg" width="175"></a></div>
        <strong>作品5</strong>
        <p>李佳琪小朋友，3岁半，作品：霸王龙</p>
    </div>
</div>

<script type="text/javascript">
var aa = 1
$(window).bind("load", function() { 
    //页面加载完成 5 秒后.指定区域内的图片会自动进行加载
    var timeout = setTimeout(function() {console.log("aaaaaaaa"); $("img.lazy").trigger("sporty")}, 5000);
});
$(function(){

    
        
    $("img:below-the-fold").lazyload({  
        failurelimit :10 ,   //  插件找到 10 个不在可见区域的图片是才停止搜索.
        event : "sporty",   //设置延迟加载
         effect : "fadeIn", //淡入效果
         threshold : 200 ,  //为 200 令图片在距离屏幕 200 像素时提前加载. 
        load:function(){

            $('#container').BlocksIt({
                numOfCol:5,
                offsetX: 8,
                offsetY: 8
            });
        }
    }); 


    window.onscroll = throttle(function (){
        // 当滚动到最底部以上50像素时， 加载新内容
        if ($(document).height() - $(this).scrollTop() - $(this).height()<50){
            aa = aa + 1

            $.ajax({
              type: "GET",
              url:  "/vendors/add_review?page="+aa,
              dataType:"text",
              success: function(msg){
                if(aa==50){
                 alert("没有更多作品了");
                }else{
                    $('#container').append(msg);      
                    var winWidth = $(window).width();
                    var conWidth;
                    if(winWidth < 500) {
                        conWidth = 330;
                        col = 1
                    } else if(winWidth < 660) {
                        conWidth = 440;
                        col = 2
                    } else if(winWidth < 880) {
                        conWidth = 660;
                        col = 3
                    } else {
                        conWidth = 1100;
                        col = 4;
                    }
                    $('#container').width(conWidth);   
                    $('#container').BlocksIt({
                        numOfCol: col,
                        offsetX: 8,
                        offsetY: 8
                    });
                    $("img.lazy").lazyload();
                }
              },
              error: function(msg){
              }
            });

            // $('#container').append($("#test").html());  
            // var winWidth = $(window).width();
            // var conWidth;
            // if(winWidth < 500) {
            //     conWidth = 330;
            //     col = 1
            // } else if(winWidth < 660) {
            //     conWidth = 440;
            //     col = 2
            // } else if(winWidth < 880) {
            //     conWidth = 660;
            //     col = 3
            // } else {
            //     conWidth = 1100;
            //     col = 4;
            // }
            // $('#container').width(conWidth);   
            // $('#container').BlocksIt({
            //     numOfCol: col,
            //     offsetX: 8,
            //     offsetY: 8
            // });
            // $("img.lazy").lazyload();
            
        }
        
    }, 500);
    
    //window resize
    var currentWidth = 1100;
    $(window).resize(function() {
        var winWidth = $(window).width();
        var conWidth;
        if(winWidth < 500) {
            conWidth = 330;
            col = 1
        } else if(winWidth < 660) {
            conWidth = 440;
            col = 2
        } else if(winWidth < 880) {
            conWidth = 660;
            col = 3
        } else {
            conWidth = 1100;
            col = 4;
        } 
        
        if(conWidth != currentWidth) {
            currentWidth = conWidth;
            $('#container').width(conWidth);
            $('#container').BlocksIt({
                numOfCol: col,
                offsetX: 8,
                offsetY: 8
            });
        }
    });
});

var winWidth = $(window).width();
var conWidth = 1100;
if(winWidth < 500) {
    conWidth = 330;
} else if(winWidth < 660) {
    conWidth = 440;
} else if(winWidth < 880) {
    conWidth = 660;
} else {
    conWidth = 1100;
} 

$('#container').width(conWidth);

</script>